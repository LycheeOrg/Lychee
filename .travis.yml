os:
  - linux

dist: xenial

language: php

php:
  - '7.2'
  - '7.3'
#  - nightly
env:
  - TRAVIS_COMPOSER_DEV=yes
  - TRAVIS_COMPOSER_DEV=no

services:
  - postgresql

addons:
  mariadb: '10.3'
  apt:
    packages:
      - php-pecl-http
      - php-imagick
      - php-mbstring
      - php-json
      - php-gd

before_script:
  - printf "\n" | pecl install imagick
  # create db for postgresql
  - psql -c 'create database homestead_test;' -U postgres
  # create db for mariadb
  - mysql -e 'create database homestead_test;'
  # composer stuff
  - composer self-update
  - if [ $TRAVIS_COMPOSER_DEV = "yes" ] ; composer install --no-interaction ; fi
  - if [ $TRAVIS_COMPOSER_DEV = "no" ] ; composer install --no-interaction --no-dev ; fi

script:
  # test mariadb
  - cp .env.mariadb.travis .env
  - php artisan key:generate
  - php artisan migrate
  - if [ $TRAVIS_COMPOSER_DEV = "yes" ] ; vendor/bin/phpunit --verbose ; fi
  # test postgresql
  - cp .env.postgresql.travis .env
  - php artisan key:generate
  - php artisan migrate
  - if [ $TRAVIS_COMPOSER_DEV = "yes" ] ; vendor/bin/phpunit --verbose ; fi
