os:
  - linux

dist: xenial

language: php

php:
  - '7.2'
  - '7.3'
#  - nightly
env:
  - TRAVIS_COMPOSER_DEV=yes
  - TRAVIS_COMPOSER_DEV=no

services:
  - postgresql

addons:
  mariadb: '10.3'
  apt:
    packages:
      - php-pecl-http
      - php-imagick
      - php-mbstring
      - php-json
      - php-gd

before_script:
  - printf "\n" | pecl install imagick
  # create db for postgresql
  - psql -c 'create database homestead_test;' -U postgres
  # create db for mariadb
  - mysql -e 'create database homestead_test;'
  # composer stuff
  - composer self-update
  - sh -c "if [ '$TRAVIS_COMPOSER_DEV' = 'yes' ] ; then composer install --no-interaction ; fi"
  - sh -c "if [ '$TRAVIS_COMPOSER_DEV' = 'no' ] ; then composer install --no-interaction --no-dev ; fi"

script:
  # test mariadb
  - cp .env.mariadb.travis .env
  - php artisan key:generate
  - php artisan migrate
  - sh -c "if [ '$TRAVIS_COMPOSER_DEV' = 'yes' ] ; then vendor/bin/phpunit --verbose; fi"
  - php artisan migrate:rollback
  # test postgresql
  - cp .env.postgresql.travis .env
  - php artisan key:generate
  - php artisan migrate
  - sh -c "if [ '$TRAVIS_COMPOSER_DEV' = 'yes' ] ; then vendor/bin/phpunit --verbose ; fi"
  - php artisan migrate:rollback

after_success:
  - sh -c "if [ '$TRAVIS_COMPOSER_DEV' = 'yes' ] ; then bash codecov.sh ; fi"

notifications:
  webhooks:
    urls:
      - secure: "c1eBiIYJlvsoRdz4nSF4UHI7OV+OKdZhbMCz4wz+ToTxXN6D//RbAZcMIBnJtuhzHpEYqvAII8UeIfP6JI2JraPt8+pjjEa+So7lEBqHPI/yBBsXVWNlcAR1w1Od2rU+L/aAn9t+PZMHCpc1DXsTfinM0+yg7V6EZ/tiLSXxCFA1B4yvECAZDWS/NwfJvM0KDjOFlBmc/7R+nu/vP1PTWWZ8x7PWl0/8uMQUCMu9yJNR9XcOiAZZa5Re0WqhsmJQdiu+/u3INvSlQsYOU/BNeoGdKf8LOFmKZnN9MnopBcHG3Y4KFbT8hmKy9Mu5CqvUXZds6EgSLc/IuTJUXLxvcBtvKUOWdHvrSugDH0gUum4xW2FKWEAPAAOMUqX88m4xYVQSIRA6lp2eZIk1u8/EDVcLNhkZIXyUNZXFXziKb0rg2AHhPB/htGRL7dE9YsVOhmzwUeWisIcRObgVIWN+1YTbWMM+pwxfTWRrAg9LDK2PX4PteqNe4Xq2AMR6JXkGlZy/2BJosdlvVHMllbX8wtJpFX8g+zCkij7Ok2wK4UhWC6m3IGa+YaPhGTammWB2Aci2CfCjsBriMQ/rpku+RM5rRZEtWM3EcymS/ZUU8JPZEBdB27dHD60RTttEXqYbETHHgRWOUZmFg/lPfO3FRsIx/OTsmqsBZ4SJMFwlasA="
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: never     # options: [always|never|change] default: always
